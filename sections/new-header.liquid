{% liquid
  assign id = section.id
%}
<link rel="stylesheet" href="{{ 'component-search.css' | asset_url }}" media="print" onload="this.media='all'">
{%- if settings.predictive_search_enabled -%}
  <link rel="stylesheet" href="{{ 'component-price.css' | asset_url }}" media="print" onload="this.media='all'">
{%- endif -%}

<style>
   .sec-{{ id }} {
    box-sizing: border-box;
    margin-top: {{section.settings.margin_top | append: 'px'}};
    margin-bottom: {{section.settings.margin_bottom | append: 'px'}};
    padding-top: {{section.settings.padding_top | append: 'px'}};
    padding-bottom: {{section.settings.padding_bottom | append: 'px'}};
  }

  @media(max-width: 1199px) {
     .sec-{{ id }} {
      margin-top: {{section.settings.margin_top_m | append: 'px'}};
      margin-bottom: {{section.settings.margin_bottom_m | append: 'px'}};
      padding-top: {{section.settings.padding_top_m | append: 'px'}};
      padding-bottom: {{section.settings.padding_bottom_m | append: 'px'}};
    }
  }
  .wrapper-{{ id }}{
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  @media screen and (min-width: 1200px){
    .wrapper-{{ id }}{
      position: relative;
    }
    .wrapper-{{ id }}:after{
      content: "";
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      height: 1px;
      width: 100%;
      background-color: #D1D5DB;
    }
    .wrapper-{{ id }}{
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-row-gap: 18px;
      .site__main-logo{
        grid-column: 1/2;
      }
      .site__nav-icons{
        grid-column: 2/-1;
        justify-content: flex-end;
      }
      .site__nav{
        grid-column: 1/2;
      }
      .header__currency{
        grid-column: 2/-1;
        display: flex;
        align-items: center;
        justify-content: flex-end;
      }
    }
  }
</style>
{% assign allowed_templates = section.settings.template_names | split: ',' %}
{% liquid
  assign logo_lg = section.settings.image
  assign logo_lg_width = section.settings.logo_width
  assign logo_sm = section.settings.image_m
  assign logo_sm_width = section.settings.logo_width_m
  if logo_sm == blank
    assign logo_sm = logo_lg
  elsif logo_lg == blank
    assign logo_lg = logo_sm
  endif
%}

{% liquid
  assign sticky_logo_lg = section.settings.sticky_logo
  assign sticky_logo_lg_width = section.settings.logo_width
  assign sticky_logo_sm = section.settings.sticky_logo
  assign sticky_logo_sm_width = section.settings.logo_width_m
  if sticky_logo_sm == blank
    assign sticky_logo_sm = sticky_logo_lg
  elsif sticky_logo_lg == blank
    assign sticky_logo_lg = sticky_logo_sm
  endif
%}

<div
  data-template="{{ template.name }}"
  data-suffix="{{ request.path | split: '/' | last }}"
  data-allowed="{{ allowed_templates }}"
  data-transparent="{{ enable_transparent }}"
  data-sticky="{{ enable_sticky }}"
  class="sec-{{ id }} site__header"
>
  <div class="{% unless section.settings.full_width %}page-width{% endunless %}">
    <div class="wrapper-{{ id }} site__header-wrapper">
      <div class="header__drawer-container hide__lg">
        <a header-drawer-opener href="#">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M3 12H15M3 6H21M3 18H21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
        {% render 'new-header-drawer',
          section: section,
          id: id,
          logo_lg: logo_lg,
          logo_lg_width: logo_lg_width,
          logo_sm: logo_sm,
          logo_sm_width: logo_sm_width
        %}
      </div>
      <a class="site__main-logo" site-logo href="/">
        {% unless logo_sm and logo_lg %}
          <h2>{{ shop.name }}</h2>
        {% else %}
          <picture>
            <source media="(min-width: 744px)" srcset="{{ logo_lg | image_url: width: logo_lg_width }}">
            {{ logo_sm | image_url: width: logo_sm_width | image_tag: class: 'regular__logo', loading: 'lazy' }}
          </picture>
        {% endunless %}
      </a>
      {% if allowed_templates contains template.name
        and section.settings.enable_transparent
        and sticky_logo_sm
        or sticky_logo_lg
      %}
        <a class="site__main-logo-sticky" site-logo href="/">
          {% unless sticky_logo_sm and sticky_logo_lg %}
            <h2>{{ shop.name }}</h2>
          {% else %}
            <picture>
              <source
                media="(min-width: 744px)"
                srcset="{{ sticky_logo_lg | image_url: width: sticky_logo_lg_width }}"
              >
              {{
                sticky_logo_sm
                | image_url: width: sticky_logo_sm_width
                | image_tag: class: 'sticky__logo', loading: 'lazy'
              }}
            </picture>
          {% endunless %}
        </a>
      {% endif %}
      <div class="site__nav-icons">
        <div class="header__search hide__sm-">
          {% render 'header-search', input_id: 'Search-In-Modal' %}
        </div>
        <div class="header__account hide__sm">
          <a account-drawer href="/account">{% render 'header-icons', name: 'account' %}</a>
        </div>
        <div class="header__cart">
          <a
            id="cart-icon-bubble"
            class="new-header-cart-icon"
            aria-label="header cart icon"
            cart-drawer
            href="{{ routes.cart_url }}"
          >
            {%- render 'header-icons', name: 'bag' -%}
          </a>
        </div>
      </div>
      <nav class="site__nav hide__sm">
        {% render 'desktop-menu', section: section, id: id %}
      </nav>
      <div class="header__currency hide__sm">
        {% render 'currency-switcher' %}
      </div>
      {% comment %}
        <div class="site__nav-top hide__sm"></div>
        <div class="site__nav-bottom hide__sm"></div>
      {% endcomment %}
    </div>
  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="{{ 'header-js.js' | asset_url }}" defer="defer"></script>
<script>
    $( document ).ready(function() {
      $("span.expand-icon-container").click(function(e) {
        e.preventDefault();
        var toClose = $("#mobile-navigation ul").not($(this).parents("ul"));
        toClose.slideUp();
        toClose.parent().removeClass("open");
        if(!$(this).parent().next().is(":visible")) {
          var toOpen = $(this).parent().next()
          toOpen.slideDown();
          toOpen.parent().not(".open").addClass("open");
        }
        e.stopPropagation();
      });
  });
</script>

{%- if request.page_type == 'index' -%}
  {% assign potential_action_target = request.origin | append: routes.search_url | append: '?q={search_term_string}' %}
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "name": {{ shop.name | json }},
      "potentialAction": {
        "@type": "SearchAction",
        "target": {{ potential_action_target | json }},
        "query-input": "required name=search_term_string"
      },
      "url": {{ request.origin | append: page.url | json }}
    }
  </script>
{%- endif -%}

{% comment %}
  {% if allowed_templates contains template.name %}
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const siteHeader = document.querySelector(".site__header");
        if (!siteHeader) return;

        const shopifySection = siteHeader.closest(".shopify-section");
        if (!shopifySection) return;

        function updateStickyClass() {
          if (window.scrollY > 300) {
            shopifySection.classList.remove("no__sticky");
            shopifySection.classList.add("sticky__header");
          } else {
            shopifySection.classList.add("no__sticky");
            shopifySection.classList.remove("sticky__header");
          }
        }

        updateStickyClass();
        window.addEventListener("scroll", updateStickyClass);

        const sectionHeight = shopifySection.offsetHeight;
        const mainContent = document.querySelector("main#MainContent");
        if (!mainContent) return;

        const firstChild = mainContent.firstElementChild;
        if (!firstChild) return;

        firstChild.style.marginTop = `-${sectionHeight}px`;
      });
    </script>
  {% endif %}

  <script>
      document.addEventListener("DOMContentLoaded", function () {
      const headerDrawer = document.querySelector(".header__drawer");
      // const overLay = document.querySelector(".overlay");
      const toggleButton = document.querySelector("[header-drawer-opener]");
      const closeButton = document.querySelector("[header-drawer-close]");
      const body = document.body;

      function toggleDrawer(event) {
        event.preventDefault();
        headerDrawer.classList.toggle("active");
        body.classList.toggle(
          "overflow-hidden",
          headerDrawer.classList.contains("active")
        );
        // overLay.classList.toggle("active");
      }

      function closeDrawer() {
        headerDrawer.classList.remove("active");
        body.classList.remove("overflow-hidden");
        // overLay.classList.remove("active");
      }

      toggleButton.addEventListener("click", toggleDrawer);
      closeButton.addEventListener("click", closeDrawer);

      document.addEventListener("click", function (e) {
        if (
          headerDrawer.classList.contains("active") &&
          !headerDrawer.contains(e.target) &&
          !toggleButton.contains(e.target)
        ) {
          closeDrawer();
        }
      });
    });
  </script>
{% endcomment %}

{% schema %}
{
  "name": "New Header",
  "class": "section-header",
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full Width Section",
      "default": true
    },
    {
      "type": "header",
      "content": "Logo"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Logo Image"
    },
    {
      "type": "image_picker",
      "id": "image_m",
      "label": "Logo Image(Mobile)"
    },
    {
      "type": "checkbox",
      "id": "enable_transparent",
      "label": "Enable Transparent Header",
      "default": true
    },
     {
      "type": "textarea",
      "id": "template_names",
      "label": "Template Names Where Sticky Nav Will be Applied",
      "info": "Enter template names separated by commas (e.g., index,product,collection,cart)"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky",
      "label": "Enable Sticky Header",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "sticky_logo",
      "label": "Transparent Header Logo"
    },
    {
      "type": "image_picker",
      "id": "sticky_logo_m",
      "label": "Transparent Header Logo(Mobile)"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 200,
      "step": 5,
      "unit": "px",
      "label": "Logo Width",
      "default": 150
    },
    {
      "type": "range",
      "id": "logo_width_m",
      "min": 50,
      "max": 200,
      "step": 5,
      "unit": "px",
      "label": "Logo Width(Mobile)",
      "default": 150
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu"
    },
    {
      "type": "header",
      "content": "Section Spacing Desktop"
    },
    {
      "type": "range",
      "id": "margin_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Top",
      "default": 24
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Bottom",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 0
    },
    {
      "type": "header",
      "content": "Section Spacing Mobile"
    },
    {
      "type": "range",
      "id": "margin_top_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Top",
      "default": 24
    },
    {
      "type": "range",
      "id": "margin_bottom_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Bottom",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding_top_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "mega-menu",
      "name": "Mega Menu",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "For item"
        },
        {
          "type": "header",
          "content": "Collection list"
        },
        {
          "type": "header",
          "content": "Collection 1"
        },
        {
          "type": "collection",
          "id": "collection_1",
          "label": "Collection"
        },
        {
          "type": "image_picker",
          "id": "image_1",
          "label": "Featured image"
        },
        {
          "type": "header",
          "content": "Collection 2"
        },
        {
          "type": "collection",
          "id": "collection_2",
          "label": "Collection"
        },
        {
          "type": "image_picker",
          "id": "image_2",
          "label": "Featured image"
        },
        {
          "type": "header",
          "content": "Collection 3"
        },
        {
          "type": "collection",
          "id": "collection_3",
          "label": "Collection"
        },
        {
          "type": "image_picker",
          "id": "image_3",
          "label": "Featured image"
        },
        {
          "type": "header",
          "content": "Collection 4"
        },
        {
          "type": "collection",
          "id": "collection_4",
          "label": "Collection"
        },
        {
          "type": "image_picker",
          "id": "image_4",
          "label": "Featured image"
        },
        {
          "type": "header",
          "content": "Collection 5"
        },
        {
          "type": "collection",
          "id": "collection_5",
          "label": "Collection"
        },
        {
          "type": "image_picker",
          "id": "image_5",
          "label": "Featured image"
        }
      ]
    }
   ],
  "presets": [
    {
      "name": "New Header"
    }
  ]
}
{% endschema %}

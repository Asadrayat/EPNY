<nav id="mobile-navigation" class="menu-drawer__navigation menu-drawer__navigation-custom">
  <ul class="parent-m menu-drawer__menu has-submenu list-menu" role="list">
    {%- for link in section.settings.menu.links -%}
      <li
        {% if link.active %}
          class="active {% if link.child_active %}child-active{% endif %}"
        {% endif %}
      >
        <div class="has-sub-menu">
          <a href="{{ link.url }}">{{ link.title }}</a>
          {%- if link.links != blank -%}
            <span class="expand-icon-container"
              ><span class="expand-icon-container-wrapper">
                {%- render 'all-icons', name: 'plus' -%}
                {%- render 'all-icons', name: 'minus' -%}
              </span></span
            >
          {%- endif %}
        </div>
        {% if link.links != blank %}
          <ul class="child-m">
            {% for child_link in link.links %}
              <li
                {% if child_link.active %}
                  class="active {% if child_link.child_active %}child-active{% endif %}"
                {% endif %}
              >
                <div class="has-double-sub-menu">
                  <a href="{{ child_link.url }}">{{ child_link.title }}</a>
                  {%- if child_link.links != blank -%}
                    <span class="expand-icon-container"
                      ><span class="expand-icon-container-wrapper">
                        {%- render 'all-icons', name: 'plus' -%}
                        {%- render 'all-icons', name: 'minus' -%}
                      </span></span
                    >
                  {%- endif %}
                </div>
                {% if child_link.links != blank %}
                  <ul class="grandchild-m">
                    {% for grandchild_link in child_link.links %}
                      <li
                        {% if grandchild_link.active %}
                          class="active {% if grandchild_link.child_active %}child-active{% endif %}"
                        {% endif %}
                      >
                        <a href="{{ grandchild_link.url }}">{{ grandchild_link.title }}</a>
                      </li>
                    {% endfor %}
                  </ul>
                {% endif %}
              </li>
            {% endfor %}
            {% liquid
              assign title_handle = link.title | handleize
              assign has_mega_item = false
            %}
            {% for block in section.blocks %}
              {% liquid
                assign menu_title = block.settings.heading | handleize

                if menu_title == blank or menu_title != title_handle
                  continue
                endif

                if menu_title == title_handle
                  assign has_mega_item = true
                endif
              %}
              {% assign has_images = false %}
              {% if has_mega_item == true %}
                {% for i in (1..5) %}
                  {% liquid
                    capture collection
                      echo 'collection_' | append: i
                    endcapture
                  %}
                  {% if block.settings[collection] != blank %}
                    {% assign has_images = true %}
                  {% endif %}
                {% endfor %}
              {% endif %}
            {% endfor %}
            {% if has_mega_item %}
              {% render 'megamenu-images-sm',
                section: section,
                link: link,
                has_mega_item: has_mega_item,
                has_images: has_images
              %}
            {% endif %}
          </ul>
        {% endif %}
      </li>
    {%- endfor -%}
  </ul>
</nav>
